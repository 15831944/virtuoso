Index: configure.ac
===================================================================
--- configure.ac	(revision 12275)
+++ configure.ac	(working copy)
@@ -712,6 +712,82 @@
 fi
 
 
+##########################################################################
+#                                                                        #
+# OpenLink Virtuoso storage support                                      #
+#                                                                        #
+##########################################################################
+
+storages_available="$storages_available virtuoso"
+
+AC_ARG_WITH(virtuoso, [  --with-virtuoso(=yes|no|2|3) Enable Virtuoso store with version (default=auto)], sqlite_api_version="$withval", sqlite_api_version="auto")
+
+with_virtuoso="no"
+AC_ARG_ENABLE(virtuoso, [dnl
+AC_HELP_STRING([--enable-virtuoso], [enable OpenLink Virtuoso storage support])
+AC_HELP_STRING([--disable-virtuoso], [disable OpenLink Virtuoso storage support (default)])dnl
+], [
+     case "${enableval}" in
+       yes)      with_virtuoso="yes" ;;
+       no)       with_virtuoso="no" ;;
+       /*)       with_virtuoso="${enableval}" ;;
+       *)        AC_MSG_ERROR(bad value ${enableval} for --enable-virtuoso) ;;
+     esac
+  ],
+  [ with_virtuoso="no" ])
+
+if test "x$with_virtuoso" != "xno" 
+then
+    AC_MSG_CHECKING([enable-virtuoso usability])
+    save_CPPFLAGS="$CPPFLAGS"
+    save_LIBS="$LIBS"
+    old_LD_LIBRARY_PATH="$LD_LIBRARY_PATH"
+    case "$with_virtuoso" in
+	yes) 
+	   virt_CFLAGS=""
+	   virt_LDFLAGS="-liodbc"
+	   ;;
+	*) 
+	   virt_CFLAGS="-I$with_virtuoso/include"
+	   virt_LDFLAGS="-L$with_virtuoso/lib -liodbc"
+	   LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$with_virtuoso/lib" 
+	   export LD_LIBRARY_PATH 
+	   ;;
+    esac
+    CPPFLAGS="$CPPFLAGS $virt_CFLAGS" 
+    LIBRDF_CPPFLAGS="$LIBRDF_CPPFLAGS $virt_CFLAGS" 
+    LIBS="$LIBS $virt_LDFLAGS"
+    LIBRDF_LDFLAGS="$LIBRDF_LDFLAGS $virt_LDFLAGS"
+    AC_TRY_RUN([
+#include <stdio.h>
+#include <stdlib.h>
+#include <time.h>
+#include <odbcinst.h>  
+int 
+main ()
+{
+  return 0;  
+}],
+[
+ AC_MSG_RESULT(good)
+ AC_DEFINE(STORAGE_VIRTUOSO,  1, [Building Virtuoso storage])
+ with_virtuoso="yes"
+],
+[
+ AC_MSG_RESULT(bad)
+ with_virtuoso="no"
+ exit
+])
+    LIBS="$save_LIBS"
+    CPPFLAGS="$save_CPPFLAGS"
+    LD_LIBRARY_PATH="$old_LD_LIBRARY_PATH"
+    export LD_LIBRARY_PATH
+fi
+AC_SUBST(virt_CFLAGS)
+AC_SUBST(virt_LDFLAGS)
+
+
+
 
 AC_ARG_WITH(sqlite, [  --with-sqlite(=yes|no|2|3) Enable SQLite store with version (default=auto)], sqlite_api_version="$withval", sqlite_api_version="auto")
 AC_ARG_WITH(sqlite-version, [  --with-sqlite-version(=yes|no|2|3) SQLite version to use (default=auto)], sqlite_api_version="$withval")
@@ -841,6 +917,7 @@
 AM_CONDITIONAL(STORAGE_HASHES, test $hashes_storage = yes)
 AM_CONDITIONAL(STORAGE_MEMORY, test $memory_storage = yes)
 AM_CONDITIONAL(STORAGE_MYSQL,  test $mysql_storage  = yes)
+AM_CONDITIONAL(STORAGE_VIRTUOSO,  test $with_virtuoso  = yes)
 AM_CONDITIONAL(STORAGE_SQLITE, test $sqlite_storage = yes)
 AM_CONDITIONAL(STORAGE_TSTORE, test $tstore_storage = yes)
 AM_CONDITIONAL(STORAGE_POSTGRESQL, test $postgresql_storage = yes)
Index: librdf/rdf_internal.h
===================================================================
--- librdf/rdf_internal.h	(revision 12275)
+++ librdf/rdf_internal.h	(working copy)
@@ -78,6 +78,7 @@
 #endif
 
 
+#define LIBRDF_ASSERT_MESSAGES 1
 #ifdef LIBRDF_ASSERT_MESSAGES
 #define LIBRDF_ASSERT_REPORT(msg) fprintf(stderr, "%s:%d: (%s) assertion failed: " msg "\n", __FILE__, __LINE__, __func__);
 #else
Index: librdf/rdf_storage.c
===================================================================
--- librdf/rdf_storage.c	(revision 12289)
+++ librdf/rdf_storage.c	(working copy)
@@ -81,6 +81,10 @@
   librdf_init_storage_file(world);
 #endif
 
+#ifdef STORAGE_VIRTUOSO
+  librdf_init_storage_virtuoso(world);
+#endif
+
 #ifdef STORAGE_MYSQL
   librdf_init_storage_mysql(world);
 #endif
Index: librdf/rdf_storage_internal.h
===================================================================
--- librdf/rdf_storage_internal.h	(revision 12275)
+++ librdf/rdf_storage_internal.h	(working copy)
@@ -175,6 +175,10 @@
 
 void librdf_init_storage_file(librdf_world *world);
 
+#ifdef STORAGE_VIRTUOSO
+void librdf_init_storage_virtuoso(librdf_world *world);
+#endif
+
 #ifdef STORAGE_MYSQL
 void librdf_init_storage_mysql(librdf_world *world);
 #endif
Index: librdf/Makefile.am
===================================================================
--- librdf/Makefile.am	(revision 12275)
+++ librdf/Makefile.am	(working copy)
@@ -110,6 +110,10 @@
 librdf_la_SOURCES += rdf_storage_mysql.c
 endif
 
+if STORAGE_VIRTUOSO
+librdf_la_SOURCES += rdf_storage_virtuoso.c
+endif
+
 if STORAGE_SQLITE
 librdf_la_SOURCES += rdf_storage_sqlite.c
 endif
